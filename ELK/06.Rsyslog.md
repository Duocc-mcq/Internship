# Đẩy log về Logstash bằng Rsyslog

## Mô hình

- Server: Đã cài ELK stack

OS: CentOS 7

IP: 192.168.30.22

- Client:

OS: CentOS 7

IP: 192.168.30.23

## Cấu hình

### Cấu hình trên server

- Cấu hình bind address cho Elasticsearch:

Truy cập file `/etc/elasticsearch/elasticsearch.yml` và sửa như trong hình, với `network.host` là địa chỉ IP máy ELK server

<img src="img/14.jpg">

- Restart Elasticsearch:

```
systemctl restart elasticsearch 
```

- Cấu hình rsyslog:

Sửa file `/etc/rsyslog.conf`, bỏ comment các dòng sau:

```
$ModLoad imudp
$UDPServerRun 514

$ModLoad imtcp
$InputTCPServerRun 514
```

- Lưu file và khởi động lại rsyslog

```
systemctl restart rsyslog
```

### Cấu hình trên client

- Cấu hình file `/etc/rsyslog.conf`, thêm dòng sau:

```
*.*		@IP_server:514
```

Thay IP của server vào phần `IP_server`. 1 dấu `@` là sử dụng UDP, `@@` để sử dụng TCP

Lưu file và khởi động lại rsyslog

```
systemctl restart rsyslog
```



## Tham khảo 

https://www.digitalocean.com/community/tutorials/how-to-centralize-logs-with-rsyslog-logstash-and-elasticsearch-on-ubuntu-14-04